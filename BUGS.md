# Баг-репорты API микросервиса объявлений

## Общая информация
- **Base URL:** https://qa-internship.avito.com
- **API Version:** 1
- **Дата тестирования:** 2025-01-XX

---

## БАГ #1: Несоответствие формата ответа POST /api/1/item спецификации

**Описание:** 
При успешном создании объявления эндпоинт `POST /api/1/item` возвращает объект с полем `status` вместо объекта с данными созданного объявления.

**Шаги воспроизведения:**
1. Отправить POST запрос на `/api/1/item` с валидными данными:
   ```json
   {
     "sellerID": 123456,
     "name": "testItem",
     "price": 9900,
     "statistics": {
       "likes": 21,
       "viewCount": 11,
       "contacts": 43
     }
   }
   ```

**Фактический результат:**
```json
{
  "status": "Сохранили объявление - {uuid}"
}
```

**Ожидаемый результат (согласно swagger.yaml):**
```json
{
  "id": "{uuid}",
  "sellerId": 123456,
  "name": "testItem",
  "price": 9900,
  "statistics": {
    "likes": 21,
    "viewCount": 11,
    "contacts": 43
  },
  "createdAt": "{timestamp}"
}
```

**Приоритет:** **High**

**Обоснование:**
- Нарушает контракт API, описанный в swagger.yaml
- Усложняет работу клиентов API, которые ожидают получить данные объявления сразу после создания
- Требует дополнительного запроса для получения данных созданного объявления
- Не соответствует стандартным практикам REST API

---

## БАГ #2: Неправильный HTTP статус код для несуществующего объявления

**Описание:** 
При запросе несуществующего объявления через `GET /api/1/item/{id}` API возвращает статус код 400 (Bad Request) вместо 404 (Not Found).

**Шаги воспроизведения:**
1. Отправить GET запрос на `/api/1/item/nonexistent-id-12345`

**Фактический результат:**
- Статус код: 400
- Тело ответа: `{"result": {"message": "передан некорректный идентификатор объявления", "messages": {}}, "status": "400"}`

**Ожидаемый результат (согласно swagger.yaml):**
- Статус код: 404
- Тело ответа: `{"result": {...}, "status": "404"}`

**Приоритет:** **Medium**

**Обоснование:**
- Нарушает стандарты HTTP: 400 используется для некорректного запроса, 404 - для отсутствующего ресурса
- Может вводить в заблуждение клиентов API
- Не соответствует спецификации в swagger.yaml

---

## БАГ #3: Неправильный HTTP статус код для несуществующего объявления в статистике

**Описание:** 
При запросе статистики несуществующего объявления через `GET /api/1/statistic/{id}` API возвращает статус код 400 (Bad Request) вместо 404 (Not Found).

**Шаги воспроизведения:**
1. Отправить GET запрос на `/api/1/statistic/nonexistent-id-12345`

**Фактический результат:**
- Статус код: 400
- Тело ответа: `{"result": {"message": "передан некорректный идентификатор объявления", "messages": {}}, "status": "400"}`

**Ожидаемый результат (согласно swagger.yaml):**
- Статус код: 404
- Тело ответа: `{"result": {...}, "status": "404"}`

**Приоритет:** **Medium**

**Обоснование:**
- Нарушает стандарты HTTP
- Не соответствует спецификации в swagger.yaml
- Создает несогласованность в обработке ошибок API

---

## БАГ #4: Отсутствие валидации на пустую строку в поле name

**Описание:** 
API принимает пустую строку `""` в поле `name` при создании объявления, что может быть нежелательным поведением.

**Шаги воспроизведения:**
1. Отправить POST запрос на `/api/1/item` с телом:
   ```json
   {
     "sellerID": 123456,
     "name": "",
     "price": 9900,
     "statistics": {
       "likes": 21,
       "viewCount": 11,
       "contacts": 43
     }
   }
   ```

**Фактический результат:**
- Статус код: 200
- Объявление создается с пустым именем

**Ожидаемый результат:**
- Статус код: 400
- Сообщение об ошибке валидации

**Приоритет:** **Medium**

**Обоснование:**
- Пустое имя объявления не имеет смысла с точки зрения бизнес-логики
- Может привести к проблемам в UI при отображении объявлений
- Снижает качество данных в системе

---

## БАГ #5: Отсутствие валидации на отрицательные значения в статистике

**Описание:** 
API принимает отрицательные значения в полях статистики (`likes`, `viewCount`, `contacts`), что не имеет смысла с точки зрения бизнес-логики.

**Шаги воспроизведения:**
1. Отправить POST запрос на `/api/1/item` с телом:
   ```json
   {
     "sellerID": 123456,
     "name": "testItem",
     "price": 9900,
     "statistics": {
       "likes": -10,
       "viewCount": -5,
       "contacts": -3
     }
   }
   ```

**Фактический результат:**
- Статус код: 200
- Объявление создается с отрицательными значениями статистики

**Ожидаемый результат:**
- Статус код: 400
- Сообщение об ошибке валидации

**Приоритет:** **Medium**

**Обоснование:**
- Отрицательные значения для статистики не имеют смысла
- Может привести к проблемам в аналитике и отчетности
- Снижает качество данных

---

## БАГ #6: Отсутствие валидации на отрицательное значение price

**Описание:** 
API принимает отрицательные значения в поле `price`, что не имеет смысла с точки зрения бизнес-логики.

**Шаги воспроизведения:**
1. Отправить POST запрос на `/api/1/item` с телом:
   ```json
   {
     "sellerID": 123456,
     "name": "testItem",
     "price": -100,
     "statistics": {
       "likes": 21,
       "viewCount": 11,
       "contacts": 43
     }
   }
   ```

**Фактический результат:**
- Статус код: 200 или 400 (нестабильное поведение)

**Ожидаемый результат:**
- Статус код: 400
- Сообщение об ошибке валидации

**Приоритет:** **Medium**

**Обоснование:**
- Отрицательная цена не имеет смысла для объявления
- Может привести к проблемам в бизнес-логике и UI

---

## БАГ #7: Несоответствие формата ответа GET /api/1/item/{id} спецификации

**Описание:** 
Эндпоинт `GET /api/1/item/{id}` возвращает массив объектов, хотя согласно swagger.yaml должен возвращать объект или массив с одним элементом. Это создает неоднозначность в формате ответа.

**Шаги воспроизведения:**
1. Создать объявление через POST /api/1/item
2. Получить объявление через GET /api/1/item/{id}

**Фактический результат:**
```json
[
  {
    "id": "{uuid}",
    "sellerId": 123456,
    "name": "testItem",
    ...
  }
]
```

**Ожидаемый результат (согласно swagger.yaml):**
Массив с одним элементом (текущее поведение корректно, но неоднозначно)

**Приоритет:** **Low**

**Обоснование:**
- Формат ответа соответствует спецификации, но может быть неоднозначным
- Для получения одного объекта логичнее возвращать объект, а не массив
- Не критично, но влияет на удобство использования API

---

## БАГ #8: Отсутствие валидации на нулевое значение price

**Описание:** 
API принимает нулевое значение в поле `price` при создании объявления.

**Шаги воспроизведения:**
1. Отправить POST запрос на `/api/1/item` с телом, где `price: 0`

**Фактический результат:**
- Статус код: 200
- Объявление создается с нулевой ценой

**Ожидаемый результат:**
- Статус код: 400 или 200 (зависит от бизнес-логики)
- Если нулевая цена недопустима, должно быть сообщение об ошибке

**Приоритет:** **Low**

**Обоснование:**
- Требует уточнения бизнес-логики: допустима ли нулевая цена
- Если недопустима, должна быть валидация

---

## БАГ #9: Несоответствие формата ответа GET /api/1/statistic/{id} спецификации

**Описание:** 
Эндпоинт `GET /api/1/statistic/{id}` возвращает массив, где первый элемент может быть `null`, что не соответствует ожидаемому формату.

**Шаги воспроизведения:**
1. Создать объявление через POST /api/1/item
2. Получить статистику через GET /api/1/statistic/{id}

**Фактический результат:**
```json
[
  {
    "likes": 21,
    "viewCount": 11,
    "contacts": 43
  }
]
```
или
```json
[null]
```

**Ожидаемый результат (согласно swagger.yaml):**
Массив с объектом статистики (nullable: true допускается, но неоднозначно)

**Приоритет:** **Low**

**Обоснование:**
- Формат соответствует спецификации (nullable: true)
- Но может быть неоднозначным для клиентов API
- Не критично, но влияет на удобство использования

---

## Резюме

**Всего обнаружено багов:** 9

**По приоритетам:**
- **High:** 1 баг (БАГ #1)
- **Medium:** 5 багов (БАГ #2, БАГ #3, БАГ #4, БАГ #5, БАГ #6)
- **Low:** 3 бага (БАГ #7, БАГ #8, БАГ #9)

**Критические проблемы:**
Основная проблема связана с несоответствием формата ответа при создании объявления спецификации API. Это требует дополнительных запросов для получения данных созданного объявления и усложняет работу клиентов API.

**Рекомендации:**
1. Исправить формат ответа POST /api/1/item для соответствия спецификации
2. Исправить HTTP статус коды для несуществующих ресурсов (404 вместо 400)
3. Добавить валидацию на пустые строки и отрицательные значения
4. Уточнить бизнес-логику для нулевых значений price

